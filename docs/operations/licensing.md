---
title: "Licensing"
linkTitle: Licensing
---

A newly installed Ondat cluster doesn't include a default licence. The cluster
will run unlicenced for 24 hours without any limitations. After this time
period, any new operations (for example: volume provisioning, adding nodes,
etc.) will not be possible. Note that any existing configuration, volumes and
data accessed and generated by your workload during the 24 hours or a licenced
cluster will not be impacted in the event of reaching either an unlicenced or
expired licence scenario. Normal functioning of the cluster can be unlocked by
applying a valid licence, either Personal or Commercial.

## Personal Licence

The personal licence requires the user to register and issue a licence through
Ondat.

The personal licence is free and grants a licence for a three-node Ondat
cluster with 1TiB of provisioned capacity. It is designed to enable basic
cloud-native workflows in Kubernetes that require the persistence of stateful
application data. Dynamic provisioning, distributed access to data and high
availability of volumes through synchronous replication and automatic failover
are some of the features that are available under the personal licence.

## Commercial Licence

For more information on our commercial offerings, including support, please
contact getstarted@ondat.io.

## Capacity limits

Ondat offerings might have defined capacity limits. Ondat allows provisioning
volumes until the limit of the licence is reached. Only the size of the volume
requested by the Persistent Volume Claim counts for the licence limit (whether
the volume has replication enabled or not doesn't matter).

Once the licence limit is reached, new volumes are not able to provision unless
provisioned capacity is released, i.e deleting volumes. That behaviour is not
tied to the capacity of the backend disks on your nodes.

# Obtaining a Licence

Once an Ondat cluster is deployed, either for testing purposes or in a
production environment, a Personal or Commercial licence can be issued. The one
common requirement to issue a licence is to provide the Ondat Customer Success
team with the Ondat Cluster ID. The following sections provide a CLI and a GUI
approach on how to get this information.

## Ondat GUI - Retrieving a Cluster ID with the Ondat GUI

The Ondat GUI is accessible by default after deployment on port 5705 of any of
Kubernetes worker nodes. For convenience, it's often the easiest to configure
port forward to the service using the following kubectl incantation (this will
block your current terminal session till the port-forward is stopped):

```shell
kubectl port-forward -n storageos svc/storageos 5705
```

The Ondat GUI can then be accessed from `http://localhost:5705` using the default
`storageos-api` secret defined during the installation as credentials (for
example: login: storageos / password: storageos) when using the
[self-evaluation guide](/docs/self-eval).

Depending on the environment, connecting to the localhost might not work when
using a remote administration machine. If this host has a private or public IP,
this IP can be set with the address parameter as such: 

```shell
kubectl port-forward -n storageos svc/storageos 5705 --address 10.20.20.20
```

The Ondat GUI can then be accessed from `http://10.20.20.20:5705`  As an
alternative, you may prefer to use an Ingress controller. You can retrieve the
Ondat cluster by browsing the __Licence__ page as shown below:

![license](/images/docs/concepts/licensing.png)

## Ondat CLI - Running the CLI

In order to get the CLI running, we must launch it on the target Kubernetes
cluster:

```shell
kubectl -n storageos create -f-<<END
apiVersion: apps/v1
kind: Deployment
metadata:
  name: storageos-cli
  namespace: storageos
  labels:
    app: storageos
    run: cli
spec:
  replicas: 1
  selector:
    matchLabels:
      app: storageos-cli
      run: cli
  template:
    metadata:
      labels:
        app: storageos-cli
        run: cli
    spec:
      containers:
      - command:
        - /bin/sh
        - -c
        - "while true; do sleep 3600; done"
        env:
        - name: STORAGEOS_ENDPOINTS
          value: http://storageos:5705
        - name: STORAGEOS_USERNAME
          value: storageos
        - name: STORAGEOS_PASSWORD
          value: storageos
        image: storageos/cli:v2.5.0
        name: cli
END
```

Be sure to edit the environment variables appropriately for your target cluster, eg. the
username/password for the administrative user. 

Once the pod is launched, we can retrieve it's unique identifier:

```shell
POD=$(kubectl -n storageos get pod -ocustom-columns=_:.metadata.name --no-headers -lapp=storageos-cli)
```

Now we've set the `POD` variable, the pod is accessible via that variable for the rest of the lifetime of
that terminal. If you open a new terminal, you'll need to run this command again to rediscover the ID of
the pod.

## Ondat CLI - Retrieving a cluster ID via the Ondat CLI

Make sure that you have the CLI running, as described in the previous step!

```shell
kubectl -n storageos exec $POD -- storageos get volumes
```

```
ID:               704dd165-9580-4da4-a554-0acb96d328cb
Licence:
  expiration:     2021-03-25T13:48:46Z (1 year from now)
  capacity:       5.0 TiB
  kind:           professional
  customer name:  storageos
Created at:       2020-03-25T13:48:33Z (1 hour ago)
Updated at:       2020-03-25T13:48:46Z (1 hour ago)
```

Don't worry if you don't see all of these fields - some of them are only
visible once you have activated a license. 

The UUID in the `ID` field is unique to your cluster and is the only information 
you need in order to obtain your first license.

## Ondat - Obtaining a Personal Licence

A personal license is aimed at individuals looking to try Ondat themselves before
running it any business-critical situation. We're happy to provide guidance and 
best-effort support with the Ondat community through our [slack channel](https://storageos.slack.com/) 
or directly by email via info@ondat.io.

To enable self-service for licenses, we provide a simple API. To request a license with curl, run:

```shell
curl -XPOST --data '{
"clusterID": "704dd165-9580-4da4-a554-0acb96d328cb",
"name": "Sally Forth",
"country": "GB",
"company": "Acme Ltd",
"companySize": 100,
"email": "sally@acme.io"
}' https://t.api.ondat.io/license
```

```
{
  "code": "200",
  "message": "License processed, please check your email for a download link."
}
```

> Be sure to change the details to reflect your own!

Do note that:
- `clusterID` must be correct for your cluster, or the license won't apply!
- `company` and `companySize` are totally optional, feel free to omit them
- `country` can be a country in ISO 3166 format or the English name of the country
- `email` will be validated and must be available and non-disposable

> If you receive an `Internal Service Error`, double-check that all the information you've 
submitted fits the above requirements!

Now check your inbox! You will have received an automatically generated email with a link to
your license file. If you don't see it, be sure to give it a few minutes and check your spam folder!

The `Download license` button on the email will work as many times as you'd like to retrieve the license - 
to renew, just submit another new license request!

Note that the resulting file is not the license itself - the license is wrapped in JSON, so you must use
`jq` or similar to unwrap it in order to activate it:

```shell
curl -XGET "https://t.api.ondat.io/license?email=sally@acme.io&payload=ABCC..."
```

```
{
  "clusterID": "704dd165-9580-4da4-a554-0acb96d328cb",
  "email": "sally@acme.io",
  "license": "..."
  "expiryTime": "2022-12-12T08:47:20.000Z"
} | jq -r '.license' > license.dat
```

The above command will 'unwrap' the license in raw mode and create the file `license.dat` in the correct
format to be imported by Ondat. The `jq` command can be run directly through a `curl` command or on a license
file downloaded from the email (eg. via 'Save Page As'), like so:

```shell
jq -r '.license' email_license.json > license.dat
```

## Ondat - The license file format

A license contains a list of capabilities and capacities, the cluster ID, an expiry time,
any extra features and a license type alongside a digital signature.

```shell
cat license.dat
```

```
clusterCapacityGiB: 5120 
clusterID: 164237eb-f88a-4bb8-a7cf-a23d468e07c0 
customerName: storageos
expiresAt: "2021-11-15T14:00:00Z" 
features:
- nfs
kind: project

------------- LICENCE SIGNATURE -------------
KyjNleTcdmieZVLmZ/rg0SzdAM7I/CH0j22FIFJJSJaeB71OvQrTMtHGyL5TSFNMrEGbyh1HQlDgZb5A
V1HyjBlS3LjoB/MoagulTxIlZh/R8eRXCOQ46qNZ8Yb7+dHLdCVXBnRqZT11hLqZsMqIeO1y9f5dw65H
kvl6vWW7YIS9r655S25jMMU7brrGDQVdjvU7tSA74BrnzDFHu7/poopIuFqcxZc/NLrKp/akkvyZI5Ex
1wH7D4onjVG2pgi30Kia+mjbI1B9pxQyRppQQ4hNXy4qBUUNMFh0menh0wHdQoM1VLU4Il22PrkeICV0
NaalLsK/96bJov6tpbg96g==
```

## Ondat GUI - Applying a Licence via the Ondat GUI 
To apply a licence:
1.  Browse the __Licence__ page of the Ondat GUI
1.  Click the __Upgrade__ button, for the specific licence level you purchased
1.  Paste the licence key into the pop-up window
1.  To apply the license click __Upgrade__

> Note: It is crucial to paste all the licence text into the pop-up and not
> just the signature. Keep in mind that the encoding of the file must not
> change.

![Apply Licence Key](/images/docs/operations/licensing/apply-licence-key.png)

## Ondat CLI - Applying a licence via the CLI

The following command will apply the licence key stored in `/path/to/storageos-licence.dat`, 
assuming that you have the CLI running as described in the sections above:

```shell
cat /path/to/storageos-license.dat | kubectl -n storageos exec -it $POD -- storageos apply license --from-stdin
```

For more information refer to the licence
[CLI command](/docs/reference/cli) reference documentation.

