<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.90.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v2.4/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v2.4/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v2.4/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v2.4/favicons/android-192x192.png" sizes="192x192">

<title>Etcd | </title><meta property="og:title" content="Etcd" />
<meta property="og:description" content="Ondat requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for Ondat installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating Ondat, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.ondat.io/v2.4/docs/prerequisites/etcd/" /><meta property="article:section" content="docs" />



<meta itemprop="name" content="Etcd">
<meta itemprop="description" content="Ondat requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for Ondat installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating Ondat, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations.">

<meta itemprop="wordCount" content="2077">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Etcd"/>
<meta name="twitter:description" content="Ondat requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for Ondat installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating Ondat, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations."/>



<link rel="stylesheet"  href="/css/font-awesome.css?ver=5.4.1" type="text/css" media="all">



<link rel="preload" href="/v2.4/scss/main.min.fb03b4520433490e70d1855f7f5ccbcf8a9a4f4783328c7c21243c1dbd3945eb.css" as="style">
<link href="/v2.4/scss/main.min.fb03b4520433490e70d1855f7f5ccbcf8a9a4f4783328c7c21243c1dbd3945eb.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>




<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<script
  src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.js"
  integrity=""
  crossorigin="anonymous"></script>
<link href="/css/storageos.css" rel="stylesheet">
<script> (function(h,o,t,j,a,r){ h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)}; h._hjSettings={hjid:1025326,hjsv:6}; a=o.getElementsByTagName('head')[0]; r=o.createElement('script');r.async=1; r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv; a.appendChild(r); })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv='); </script>
<script src="/js/enable-link-tab.js"></script>


    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KXRX3CX');</script>


    <title>Etcd | </title>
  </head>
  <body class="td-page">
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXRX3CX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    <header>
      <div id="ondat-lp-header">
  <div class="ondat-lp-header-wrapper">
    <div class="ondat-lp-header-wrapper-left">
      <a class="navbar-brand" href="https://ondat.io">
        <svg width="135" height="24" viewBox="0 0 135 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M48.8466 13.2064V10.5821c0-4.27515 2.2857-6.56086 6.9841-6.56086 4.8254.0 6.9418 2.20106 6.9418 6.56086v2.6243c0 4.2328-2.2857 6.5609-6.9418 6.5609C50.963 19.8096 48.8466 17.6085 48.8466 13.2064zm10.836-2.6243C59.6826 8.0424 58.836 6.94188 55.8731 6.94188c-2.963.0-3.8519 1.10052-3.8519 3.64022v2.6243c0 2.5397.846600000000002 3.6402 3.8519 3.6402 2.9629.0 3.8095-1.0582 3.8095-3.6402V10.5821z" fill="#1239b8"/><path d="M68.91 18.074C68.91 19.1745 68.6561 19.4285 67.5555 19.4285H67.1746C66.074 19.4285 65.8201 19.1745 65.8201 18.074V9.90469C65.8201 5.96818 68.0635 3.97876 72.4656 3.97876 77.0793 3.97876 79.0687 5.96818 79.0687 9.90469V18.074C79.0687 19.1745 78.8148 19.4285 77.7143 19.4285h-.381C76.2328 19.4285 75.9788 19.1745 75.9788 18.074V9.90469C75.9788 7.83061 75.2169 6.94172 72.5079 6.94172 69.7989 6.94172 68.9947 7.87294 68.9947 9.90469V18.074H68.91z" fill="#1239b8"/><path d="M95.1534 13.5026C95.1534 17.6931 92.9947 19.7248 88.6772 19.7248 84.1481 19.7248 82.2433 17.5237 82.2433 13.5026v-2.963c0-4.06347 1.7778-6.26453 6.2646-6.26453 2.5397.0 4.1905.80423 4.9524 2.45502V1.31211C93.4603.719513 93.6296.592529 94.1799.592529H94.3492C94.9418.592529 95.0687.761841 95.0687 1.31211V13.5026H95.1534zm-11.2593.0C83.8941 16.7618 85.037 18.2433 88.7195 18.2433c3.64030000000001.0 4.8254-1.4815 4.8254-4.7407V10.4973C93.5449 7.23803 92.4021 5.75655 88.7195 5.75655 85.0793 5.75655 83.8941 7.23803 83.8941 10.4973v3.0053z" fill="#017efa"/><path d="M111.323 19.0053C111.323 19.5979 111.153 19.7249 110.603 19.7249H110.434C109.841 19.7249 109.714 19.5556 109.714 19.0053V17.3122C108.952 18.9207 107.259 19.7672 104.762 19.7672c-4.487.0-6.2646-2.2434-6.2646-6.2645V10.4974C98.4974 6.43388 100.317 4.27515 104.931 4.27515c4.27500000000001.0 6.476 2.07407 6.476 6.22225v8.5079H111.323zm-11.302-5.5026c0 3.2592 1.143 4.7407 4.82599999999999 4.7407 3.682.0 4.825-1.4815 4.825-4.7407V10.4974c0-3.25929-1.143-4.74077-4.825-4.74077C101.164 5.75663 100.021 7.23811 100.021 10.4974v3.0053z" fill="#017efa"/><path d="M113.862 5.3756C113.862 4.99465 113.947 4.86766 114.413 4.78301l1.947-.21164L116.656 1.14279C116.741.677185 116.868.592529 117.249.592529H117.418C117.884.592529 117.968.761841 117.968 1.14279V4.57137h5.461C124.021 4.57137 124.148 4.74068 124.148 5.29094v.12699C124.148 5.92586 124.021 6.1375 123.429 6.1375h-5.461v8.4233c0 2.709 1.101 3.7248 3.133 3.7248C122.159 18.2856 123.09 18.1587 123.979 17.9047 124.444 17.7354 124.698 17.947 124.698 18.4973V18.6243C124.698 19.1322 124.529 19.3438 123.979 19.4708 123.132 19.7248 122.201 19.8518 121.143 19.8518c-3.217.0-4.783-1.7778-4.783-5.2487V6.05285h-1.947C114.032 6.05285 113.862 5.88353 113.862 5.50258V5.3756z" fill="#017efa"/><path d="M130.794 4.78311C130.794 4.95242 130.751 4.99475 130.582 4.99475H129.905v2.1164C129.905 7.32279 129.862 7.36512 129.651 7.36512H129.566C129.355 7.36512 129.312 7.32279 129.312 7.11115V4.99475H128.635C128.466 4.99475 128.423 4.95242 128.423 4.78311V4.69846C128.423 4.52914 128.466 4.48682 128.635 4.48682h1.947C130.751 4.48682 130.794 4.52914 130.794 4.69846V4.78311zM134.392 7.11115C134.392 7.32279 134.349 7.36512 134.138 7.36512H134.053C133.841 7.36512 133.799 7.32279 133.799 7.11115V4.99475L133.206 7.06883C133.164 7.28047 133.079 7.36512 132.825 7.36512 132.656 7.36512 132.529 7.28047 132.444 7.06883L131.852 4.99475v2.1164C131.852 7.32279 131.81 7.36512 131.598 7.36512H131.513C131.302 7.36512 131.259 7.32279 131.259 7.11115V4.86777c0-.25397.12700000000001-.38095.381-.38095H131.894C132.148 4.48682 132.318 4.65613 132.402 4.95242L132.825 6.60322 133.291 4.86777C133.333 4.57147 133.503 4.48682 133.841 4.48682H133.968C134.222 4.48682 134.349 4.6138 134.349 4.86777V7.11115H134.392z" fill="#017efa"/><path d="M0 7.83057V16.1692l10.1587-4.1905L0 7.83057z" fill="#017efa"/><path d="M10.1587 11.9788l8.9736-3.64018V0L0 7.83069 10.1587 11.9788z" fill="#1239b8"/><path d="M0 16.1692l19.1323 7.8307V15.6613l-8.9736-3.6825L0 16.1692z" fill="#0bbbef"/><path d="M30.0106 11.9787l10.1587 4.1905V7.83057L30.0106 11.9787z" fill="#017efa"/><path d="M40.1692 7.83069 20.9946.0V8.33862l9.0159 3.64018L40.1692 7.83069z" fill="#0bbbef"/><path d="M20.9946 15.6613v8.3386l19.1746-7.8307-10.1587-4.1904-9.0159 3.6825z" fill="#1239b8"/></g><defs><clipPath id="clip0"><rect width="134.392" height="24" fill="#fff"/></clipPath></defs></svg>
        <span class="text-uppercase font-weight-bold"></span>
      </a>
      <ul class="ondat-lp-menu">
        <li class="ondat-lp-menu-drop">
          <a href="#">Platform</a>
          <ul>
            <li><a href="https://ondat.io/platform/platform-overview">Platform Overview</a></li>
            <li><a href="https://ondat.io/platform/how-it-works">How it works</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-drop">
          <a href="#">Teams</a>
          <ul>
            <li><a href="https://ondat.io/teams/development">Development</a></li>
            <li><a href="https://ondat.io/teams/devops-sre">DevOps SRE</a></li>
            <li><a href="https://ondat.io/digital-transformation">Digital Transformation</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-drop">
          <a href="#">Solutions</a>
          <ul>
            <li><a href="https://ondat.io/solutions/stateful-applications">Stateful Apps</a></li>
            <li><a href="https://ondat.io/solutions/kubernetes-distributions">Kubernetes Distros</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-no-drop"><a href="https://www.ondat.io/blog">Blog</a></li>
        <li class="ondat-lp-menu-no-drop"><a href="https://docs.ondat.io">Resources</a></li>
        
        <li class="ondat-lp-menu-drop">
          <a href="#">Releases</a>
          <ul>
            
            <li><a class="dropdown-item" href="/v1.x">v1.x</a></li>
            
            <li><a class="dropdown-item" href="/v2.0">v2.0</a></li>
            
            <li><a class="dropdown-item" href="/v2.1">v2.1</a></li>
            
            <li><a class="dropdown-item" href="/v2.2">v2.2</a></li>
            
            <li><a class="dropdown-item" href="/v2.3">v2.3</a></li>
            
            <li><a class="dropdown-item" href="/v2.4">v2.4</a></li>
            
            <li><a class="dropdown-item" href="/">v2.5</a></li>
            
          </ul>
        </li>
        
      </div>
      </ul>
    <div class="ondat-lp-header-wrapper-right">
      <a href="https://www.ondat.io/request-demo" class="gs-btn">Get started for free</a>
      


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v2.4/offline-search-index.36f1a0944b78b1d5f3944b72c2494db7c927b75e8d0c5bea080f0940d25d34ea8ead5d620c613b65c74a9a8a48045ea6e0422ee6d8a985dbbcca3cb501d2d1bb.json"
  data-offline-search-base-href="/"
>


    </div>
  </div>
</div>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Open+Sans:wght@500&display=swap");

  #ondat-lp-header {
    width: 100%;
    padding: 20px 0;
    background-color: white;
    font-weight: 500;
  }

  .ondat-lp-header-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1240px;
    margin: auto;
  }

  .ondat-lp-header-wrapper-left {
    display: flex;
    align-items: center;
  }

  ul.ondat-lp-menu,
  ul.ondat-lp-menu li {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  ul.ondat-lp-menu {
    display: flex;
  }

  ul.ondat-lp-menu > li {
    margin-left: 48px;
  }

  li.ondat-lp-menu-drop > a {
    display: flex;
    align-items: center;
  }

  li.ondat-lp-menu-no-drop a {
    display: flex;
    align-items: center;
  }

  li.ondat-lp-menu-drop > a:after {
    display: inline-block;
    content: "";
    width: 8px;
    height: 5px;
    margin-left: 6px;
    background: url("images/drop.svg") no-repeat;
  }

  li.ondat-lp-menu-drop ul {
    display: none;
    box-shadow: 0px 10px 35px 5px rgb(50 50 50 / 15%);
    background-color: white;
    border-top: 2px solid #017efa;
    position: absolute;
    padding-left: 0;
    padding: 15px;
    margin-left: 0;
  }

  li.ondat-lp-menu-drop ul > li {
    list-style: none;
    margin-bottom: 10px;
    line-height: normal;
    font-size: 13px;
  }

  li.ondat-lp-menu-drop ul > li:last-child {
    margin-bottom: 0px;
  }

  li.ondat-lp-menu-drop ul > li > a {
    font-size: 13px !important;
    font-weight: 700 !important;
  }

  li.ondat-lp-menu-drop:hover ul {
    display: block;
  }

  li.ondat-lp-menu-drop:hover ul {
    display: block;
  }

  #ondat-lp-header a {
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    color: #081d60;
    font-family: "Plus Jakarta Display";
  }

  .ondat-lp-header-wrapper-right {
    display: flex;
    align-items: center;
  }

  #ondat-lp-header a.gs-btn {
    color: #017efa;
    display: block;
    padding: 10px 24px;
  }

  #ondat-lp-header a.login-btn {
    color: #fff;
    font-weight: 700;
    display: block;
    padding: 10px 24px;
    background-color: #017efa;
    border-radius: 4px;
  }
</style>

    </header>
    <div class="body-search">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#td-section-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v2.4/offline-search-index.36f1a0944b78b1d5f3944b72c2494db7c927b75e8d0c5bea080f0940d25d34ea8ead5d620c613b65c74a9a8a48045ea6e0422ee6d8a985dbbcca3cb501d2d1bb.json"
  data-offline-search-base-href="/"
>


  </div>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation V2</a>
  </li>
  <ul>
    <li class="collapse show" id="v24docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/introduction/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Introduction</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsintroduction">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsintroductionoverview" href="/v2.4/docs/introduction/overview/">Ondat V2 Overview</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsintroductionquickstart" href="/v2.4/docs/introduction/quickstart/">Quickstart</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsintroductionplatforms" href="/v2.4/docs/introduction/platforms/">Supported Platforms</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsconcepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptscluster-topologies" href="/v2.4/docs/concepts/cluster-topologies/">Cluster Topologies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsclusters" href="/v2.4/docs/concepts/clusters/">Clusters</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptscompression" href="/v2.4/docs/concepts/compression/">Compression</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsetcd" href="/v2.4/docs/concepts/etcd/">Etcd</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsfencing" href="/v2.4/docs/concepts/fencing/">Fencing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsnamespaces" href="/v2.4/docs/concepts/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsnodes" href="/v2.4/docs/concepts/nodes/">Nodes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptscomponents" href="/v2.4/docs/concepts/components/">Ondat Components</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptspolicies" href="/v2.4/docs/concepts/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsrwx" href="/v2.4/docs/concepts/rwx/">ReadWriteMany</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsreplication" href="/v2.4/docs/concepts/replication/">Replication</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsconceptsvolumes" href="/v2.4/docs/concepts/volumes/">Volumes</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/prerequisites/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Prerequisites</a>
  </li>
  <ul>
    <li class="collapse show" id="v24docsprerequisites">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitessystemconfiguration" href="/v2.4/docs/prerequisites/systemconfiguration/">System Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitesipv6" href="/v2.4/docs/prerequisites/ipv6/">Availability of IPv6</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitesfirewalls" href="/v2.4/docs/prerequisites/firewalls/">Ports and Firewall settings</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitesmountpropagation" href="/v2.4/docs/prerequisites/mountpropagation/">Mount Propagation</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitespidlimits" href="/v2.4/docs/prerequisites/pidlimits/">PID Limits</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsprerequisitesmax-aio" href="/v2.4/docs/prerequisites/max-aio/">Max AIO</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-v24docsprerequisitesetcd" href="/v2.4/docs/prerequisites/etcd/">Etcd</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/install/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Install</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsinstall">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsinstallkubernetes" href="/v2.4/docs/install/kubernetes/">Kubernetes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsinstallopenshift" href="/v2.4/docs/install/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsinstallrancher" href="/v2.4/docs/install/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/platforms/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Platforms</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsplatforms">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsaws-eks" href="/v2.4/docs/platforms/aws-eks/">AWS EKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsazure-aks" href="/v2.4/docs/platforms/azure-aks/">Azure AKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsdockeree" href="/v2.4/docs/platforms/dockeree/">DockerEE</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsgoogle-gke" href="/v2.4/docs/platforms/google-gke/">Google GKE</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsopenshift" href="/v2.4/docs/platforms/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsplatformsrancher" href="/v2.4/docs/platforms/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsbest-practices" href="/v2.4/docs/best-practices/">Best Practices</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/operations/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Operations</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsoperations">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationscluster-id" href="/v2.4/docs/operations/cluster-id/">ClusterID</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsdelete-stos-objects" href="/v2.4/docs/operations/delete-stos-objects/">Deleting Ondat Objects</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsdisk-full" href="/v2.4/docs/operations/disk-full/">Disk Full</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsencryption" href="/v2.4/docs/operations/encryption/">Encryption</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/operations/etcd/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Etcd</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsoperationsetcd">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsetcdmigrate-etcd-cluster" href="/v2.4/docs/operations/etcd/migrate-etcd-cluster/">Etcd node migration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsetcdstorageos-secret-info" href="/v2.4/docs/operations/etcd/storageos-secret-info/">mTLS</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsfailure-modes" href="/v2.4/docs/operations/failure-modes/">Failure Modes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsfencing" href="/v2.4/docs/operations/fencing/">Fencing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsfirstpvc" href="/v2.4/docs/operations/firstpvc/">First PVC</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationshealth" href="/v2.4/docs/operations/health/">Health</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsmanaging-host-storage" href="/v2.4/docs/operations/managing-host-storage/">Host Storage</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationslabel-stos-objects" href="/v2.4/docs/operations/label-stos-objects/">Labeling Ondat Objects</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationslicensing" href="/v2.4/docs/operations/licensing/">Licensing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsnamespaces" href="/v2.4/docs/operations/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationspolicies" href="/v2.4/docs/operations/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsrwx" href="/v2.4/docs/operations/rwx/">ReadWriteMany</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsstorageclasses" href="/v2.4/docs/operations/storageclasses/">StorageClasses</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationstrim" href="/v2.4/docs/operations/trim/">TRIM</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationstroubleshooting" href="/v2.4/docs/operations/troubleshooting/">Troubleshooting</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsuninstall" href="/v2.4/docs/operations/uninstall/">Uninstall Ondat</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsupgrade" href="/v2.4/docs/operations/upgrade/">Upgrade Ondat</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsusers" href="/v2.4/docs/operations/users/">User Management</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsoperationsresize" href="/v2.4/docs/operations/resize/">Volume Resize</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/usecases/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Use Cases</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsusecases">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasescassandra" href="/v2.4/docs/usecases/cassandra/">Cassandra</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecaseselasticsearch" href="/v2.4/docs/usecases/elasticsearch/">Elasticsearch</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesinfluxdb" href="/v2.4/docs/usecases/influxdb/">InfluxDB</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesjenkins" href="/v2.4/docs/usecases/jenkins/">Jenkins</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecaseskafka" href="/v2.4/docs/usecases/kafka/">Kafka</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecaseskubevirt" href="/v2.4/docs/usecases/kubevirt/">Kubevirt</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesmssql" href="/v2.4/docs/usecases/mssql/">MS SQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesmysql" href="/v2.4/docs/usecases/mysql/">MySQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesnginx" href="/v2.4/docs/usecases/nginx/">Nginx</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasespostgres" href="/v2.4/docs/usecases/postgres/">PostgreSQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesprometheus" href="/v2.4/docs/usecases/prometheus/">Prometheus</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesredis" href="/v2.4/docs/usecases/redis/">Redis</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasessidecar-backups" href="/v2.4/docs/usecases/sidecar-backups/">Sidecar Backups</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecasesvelero-backups" href="/v2.4/docs/usecases/velero-backups/">Velero Backups</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsusecaseszookeeper" href="/v2.4/docs/usecases/zookeeper/">Zookeeper</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/reference/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Reference</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsreference">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/reference/bundles/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Bundles</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsreferencebundles">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencebundlesdiagnostic-bundle" href="/v2.4/docs/reference/bundles/diagnostic-bundle/">Diagnostic bundle</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencebundlessupport_bundle" href="/v2.4/docs/reference/bundles/support_bundle/">Support bundle</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceapi" href="/v2.4/docs/reference/api/">API Reference</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/reference/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CLI</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsreferencecli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecliapply" href="/v2.4/docs/reference/cli/apply/">Apply</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecliattach" href="/v2.4/docs/reference/cli/attach/">Attach</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceclicreate" href="/v2.4/docs/reference/cli/create/">Create</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceclidelete" href="/v2.4/docs/reference/cli/delete/">Delete</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceclidescribe" href="/v2.4/docs/reference/cli/describe/">Describe</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceclidetach" href="/v2.4/docs/reference/cli/detach/">Detach Volume</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecliget" href="/v2.4/docs/reference/cli/get/">Get</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceclihelp" href="/v2.4/docs/reference/cli/help/">Help</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecliupdate" href="/v2.4/docs/reference/cli/update/">Update volume</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecliversion" href="/v2.4/docs/reference/cli/version/">Version</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/reference/cluster-operator/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Cluster Operator</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsreferencecluster-operator">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecluster-operatorinstall" href="/v2.4/docs/reference/cluster-operator/install/">Install</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecluster-operatorconfiguration" href="/v2.4/docs/reference/cluster-operator/configuration/">Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecluster-operatorexamples" href="/v2.4/docs/reference/cluster-operator/examples/">Examples</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecluster-operatorupgrade" href="/v2.4/docs/reference/cluster-operator/upgrade/">Operator upgrade</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencecontributing" href="/v2.4/docs/reference/contributing/">Contributing to the docs</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceencryption" href="/v2.4/docs/reference/encryption/">Encryption</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencegui" href="/v2.4/docs/reference/gui/">GUI</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceinit-container" href="/v2.4/docs/reference/init-container/">Init container</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencekubernetes-object-sync" href="/v2.4/docs/reference/kubernetes-object-sync/">Kubernetes Object Sync</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencelabels" href="/v2.4/docs/reference/labels/">Labels</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencelicence" href="/v2.4/docs/reference/licence/">Licence</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencetelemetry" href="/v2.4/docs/reference/telemetry/">Ondat Telemetry</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceopen_source_attribution" href="/v2.4/docs/reference/open_source_attribution/">Open Source Attribution</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencerelease_notes" href="/v2.4/docs/reference/release_notes/">Release notes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferenceresource_requests_and_limits" href="/v2.4/docs/reference/resource_requests_and_limits/">Resource Requests and Limits</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.4/docs/reference/scheduler/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Scheduler</a>
  </li>
  <ul>
    <li class="collapse " id="v24docsreferencescheduler">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencescheduleradmission-controller" href="/v2.4/docs/reference/scheduler/admission-controller/">Admission Controller</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencefilesystems" href="/v2.4/docs/reference/filesystems/">Supported File systems</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsreferencetolerations" href="/v2.4/docs/reference/tolerations/">Tolerations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docssupport" href="/v2.4/docs/support/">Support</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v24docsself-eval" href="/v2.4/docs/self-eval/">Self Evaluation Guide</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            













          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://docs.ondat.io/v2.4/docs/">Documentation V2</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://docs.ondat.io/v2.4/docs/prerequisites/">Prerequisites</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.ondat.io/v2.4/docs/prerequisites/etcd/">Etcd</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Etcd</h1>
	
	<p>Ondat requires an etcd cluster in order to function. For more information
on why etcd is required please see our <a href="https://docs.ondat.io/v2.4/docs/concepts/etcd/">etcd concepts</a> page.</p>
<p>We do not support using the Kubernetes etcd for Ondat installations.</p>
<p>We provide two methods for installing etcd. For those looking for a quick
route to evaluating Ondat, our first method installs etcd into your
Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS
operator, this installation is not backed by any persistent storage, and
therefore is unsuitable for production installations.</p>
<p>For production installations, there is currently no satisfactory way of
installing a production-grade etcd cluster inside Kubernetes (although the
landscape is changing rapidly, watch this space), and our production guidance
remains to install etcd on separate machines outside of your Kubernetes
cluster. This method is the best way to ensure a stable Ondat cluster.
Please see our etcd operations page for additional information on deployment
<a href="https://docs.ondat.io/v2.4/docs/operations/etcd/">best practices</a> and concerns.</p>
<ol>
<li>Ephemeral pods within Kubernetes (<em>Testing</em>)</li>
<li>External Virtual Machines (<em>Production</em>)</li>
</ol>
<p>Click the tabs below to select the installation method of your choice.</p>
<nav>
	<div class="nav nav-tabs" id="nav-tab" role="tablist">

		
		
		
		

            
            

            
            

            

            

		<a class="nav-item nav-link active" id="nav-9" data-toggle="tab" href="#testing" role="tab"
		   aria-controls="nav-home" aria-selected="true">Testing</a>

            
		

            
            

            
            

            

            

		<a class="nav-item nav-link" id="nav-9" data-toggle="tab" href="#production" role="tab"
		   aria-controls="nav-home" aria-selected="false">Production</a>

            
		

	</div>
</nav>

<div class="tab-content" id="9">
    <br></br>








<div class="tab-pane fade show active" id="testing" role="tabpanel" aria-labelledby="nav-testing">
    <h2 id="testing---installing-etcd-into-your-kubernetes-cluster">Testing - Installing Etcd Into Your Kubernetes Cluster</h2>
<p><strong>This fast and convenient method is useful for quickly creating an etcd
cluster in order to evaluate Ondat. Do not use it for production
installations.</strong></p>
<p>This method uses the <a href="https://github.com/coreos/etcd-operator">CoreOS
etcd-operator</a> to install a 3 node
etcd cluster within your Kubernetes cluster, in the <code>storageos-etcd</code>
namespace. We then install a Kubernetes service in that same namespace.</p>
<p>The official etcd-operator repository also has a backup deployment operator
that can help backup etcd data. <strong>A restore of the etcd keyspace from a backup
might cause issues</strong> due to the disparity between the cluster state and its
metadata in a different point in time. If you need to restore from a backup
after a failure of etcd, contact the Ondat support team.</p>
<h3 id="quick-install">Quick Install</h3>
<p>For a one command install, the following script uses <code>kubectl</code> to create an
etcd cluster in the <code>storageos-etcd</code> namespace. It requires kubectl in the
system path, and the context set to the appropriate cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -s https://docs.ondat.io/v2.4/sh/deploy-etcd.sh <span style="color:#000;font-weight:bold">|</span> bash
</code></pre></div><h3 id="installation-step-by-step">Installation Step by Step</h3>
<p>For those who would prefer to execute the steps by themselves, they are as
follows:</p>
<ol>
<li>
<p>Configure Namespace</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span>storageos-etcd
</code></pre></div></li>
<li>
<p>Create Namespace</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create namespace <span style="color:#000">$NAMESPACE</span>
</code></pre></div></li>
<li>
<p>If running in Openshift, an SCC is needed to start Pods</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc adm policy add-scc-to-user anyuid system:serviceaccount:<span style="color:#000">$NAMESPACE</span>:default
</code></pre></div></li>
<li>
<p>Create ClusterRole and ClusterRoleBinding</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> $ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f-<span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06"> apiVersion: rbac.authorization.k8s.io/v1beta1
</span><span style="color:#4e9a06"> kind: ClusterRoleBinding
</span><span style="color:#4e9a06"> metadata:
</span><span style="color:#4e9a06">   name: etcd-operator
</span><span style="color:#4e9a06"> roleRef:
</span><span style="color:#4e9a06">   apiGroup: rbac.authorization.k8s.io
</span><span style="color:#4e9a06">   kind: ClusterRole
</span><span style="color:#4e9a06">   name: etcd-operator
</span><span style="color:#4e9a06"> subjects:
</span><span style="color:#4e9a06">   - kind: ServiceAccount
</span><span style="color:#4e9a06">     name: default
</span><span style="color:#4e9a06">     namespace: $NAMESPACE
</span><span style="color:#4e9a06">END</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f-<span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06">apiVersion: rbac.authorization.k8s.io/v1beta1
</span><span style="color:#4e9a06">kind: ClusterRole
</span><span style="color:#4e9a06">metadata:
</span><span style="color:#4e9a06">  name: etcd-operator
</span><span style="color:#4e9a06">rules:
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - etcd.database.coreos.com
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - etcdclusters
</span><span style="color:#4e9a06">  - etcdbackups
</span><span style="color:#4e9a06">  - etcdrestores
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - apiextensions.k8s.io
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">   - customresourcedefinitions
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - &#34;&#34;
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - pods
</span><span style="color:#4e9a06">  - services
</span><span style="color:#4e9a06">  - endpoints
</span><span style="color:#4e9a06">  - persistentvolumeclaims
</span><span style="color:#4e9a06">  - events
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - apps
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - deployments
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06"># The following permissions can be removed if not using S3 backup and TLS
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - &#34;&#34;
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - secrets
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - get
</span><span style="color:#4e9a06">END</span>
</code></pre></div></li>
<li>
<p>Deploy Etcd Operator</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f - <span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06">apiVersion: apps/v1
</span><span style="color:#4e9a06">kind: Deployment
</span><span style="color:#4e9a06">metadata:
</span><span style="color:#4e9a06">  name: etcd-operator
</span><span style="color:#4e9a06">spec:
</span><span style="color:#4e9a06">  selector:
</span><span style="color:#4e9a06">    matchLabels:
</span><span style="color:#4e9a06">      app: etcd-operator
</span><span style="color:#4e9a06">  replicas: 1
</span><span style="color:#4e9a06">  template:
</span><span style="color:#4e9a06">    metadata:
</span><span style="color:#4e9a06">      labels:
</span><span style="color:#4e9a06">        app: etcd-operator
</span><span style="color:#4e9a06">    spec:
</span><span style="color:#4e9a06">      containers:
</span><span style="color:#4e9a06">      - name: etcd-operator
</span><span style="color:#4e9a06">        image: quay.io/coreos/etcd-operator:v0.9.4
</span><span style="color:#4e9a06">        command:
</span><span style="color:#4e9a06">        - etcd-operator
</span><span style="color:#4e9a06">        env:
</span><span style="color:#4e9a06">        - name: MY_POD_NAMESPACE
</span><span style="color:#4e9a06">          valueFrom:
</span><span style="color:#4e9a06">            fieldRef:
</span><span style="color:#4e9a06">              fieldPath: metadata.namespace
</span><span style="color:#4e9a06">        - name: MY_POD_NAME
</span><span style="color:#4e9a06">          valueFrom:
</span><span style="color:#4e9a06">            fieldRef:
</span><span style="color:#4e9a06">              fieldPath: metadata.name
</span><span style="color:#4e9a06">END</span>
</code></pre></div><p>Wait for the Etcd Operator Pod to start</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl -n <span style="color:#000">$NAMESPACE</span> get pod -lapp<span style="color:#ce5c00;font-weight:bold">=</span>etcd-operator
</code></pre></div></li>
<li>
<p>Create the EtcdCluster resource</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">$ kubectl -n $NAMESPACE create -f - &lt;&lt;END</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;etcd.database.coreos.com/v1beta2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;EtcdCluster&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;storageos-etcd&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;3.4.7&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcdEnv</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ETCD_QUOTA_BACKEND_BYTES</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2147483648&#34;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 2 GB</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ETCD_AUTO_COMPACTION_RETENTION</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Keep 1000 revisions (default)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ETCD_AUTO_COMPACTION_MODE</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;revision&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Set the revision mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">requests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">200m</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">300Mi</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">securityContext</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">runAsNonRoot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">runAsUser</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">fsGroup</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Exists&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">podAntiAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">podAffinityTerm</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd_cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#000">storageos-etcd</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes.io/hostname</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">END</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
</ol>
<h3 id="installation-verification">Installation Verification</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n storageos-etcd get pod,svc
NAME                                 READY   STATUS    RESTARTS   AGE
pod/etcd-operator-55978c4587-8kx7b   1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-qm9tmrpnlm        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-rzhjdz74hp        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-wvvv2d9g98        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h

NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP PORT<span style="color:#ce5c00;font-weight:bold">(</span>S<span style="color:#ce5c00;font-weight:bold">)</span>             AGE
service/storageos-etcd          ClusterIP   None             &lt;none&gt;      2379/TCP,2380/TCP   22h
service/storageos-etcd-client   ClusterIP   172.30.132.255   &lt;none&gt;      2379/TCP            22h
</code></pre></div><blockquote>
<p>The URL from the Service <code>storageos-etcd-client.storageos-etcd.svc:2379</code>
will be used later in the Ondat Cluster CustomResource the
<code>kvBackend.address</code>.</p>
</blockquote>
<h2 id="known-etcd-operator-issues">Known etcd-operator issues</h2>
<p>Etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. If quorum is lost, etcd nodes stop and etcd marks its contents as
read-only. This is because it cannot guarantee that new data will be valid.
Quorum is fundamental for etcd operations. When running etcd using the CoreOS
Operator, it is important to consider that a loss of quorum could arise from
etcd pods being evicted from nodes.</p>
<p>Operations such as Kubernetes Upgrades with rolling node pools could cause a
total failure of the etcd cluster as nodes are discarded in favor of new ones.</p>
<p>A 3 etcd node cluster can survive losing one node and recover, a 5 node
cluster can survive the loss of two nodes. Loss of further nodes will result in quorum being lost.</p>
<p><strong>The etcd-operator doesn&rsquo;t support a full stop of the cluster. Stopping the
etcd cluster causes the loss of all the etcd keystore and make Ondat
unable to perform metadata changes.</strong></p>

</div>









<div class="tab-pane fade" id="production" role="tabpanel" aria-labelledby="nav-production">
    <h2 id="production---etcd-on-external-virtual-machines">Production - Etcd on External Virtual Machines</h2>
<p>For production installations, Ondat strongly recommends running etcd
outside of Kubernetes on a minimum of 3 dedicated virtual machines. This
topology offers strong guarantees of resilience and uptime. We recommend this
architecture in all environments, including those where Kubernetes is being
deployed as a managed service.</p>
<p>Ondat doesn&rsquo;t require a high performance etcd cluster, as the throughput
of metadata to the cluster is low. However, we recommend a careful assessment
of IOPS capacity <a href="https://docs.ondat.io/v2.4/docs/operations/etcd/#iops-requirements">best practices</a> to ensure that etcd
operates normally.</p>
<p>Depending on the level of redundancy you feel comfortable with you can install
etcd on the Kubernetes Master nodes. <strong>Take extreme care to avoid collisions
of the Ondat etcd installation with the Kubernetes etcd when using the
Kubernetes Master nodes. Precautions such as changing the default
configuration for the client and peer ports, and ensuring the etcd data
directory is modified. The ansible playbook below will default the etcd
installation directory to <code>/var/lib/storageos-etcd</code>.</strong></p>
<p>You can choose between two installation options.</p>
<ul>
<li><a href="#installation---manual">Manual Installation</a></li>
<li><a href="#installation---ansible">Ansible Installation</a></li>
</ul>
<h3 id="installation---manual">Installation - Manual</h3>
<p>This section documents the steps required for manual installation of etcd
using standard package management commands and systemd manifests.</p>
<blockquote>
<p><strong>Repeat the following steps on all the nodes that will run etcd as a
systemd service.</strong></p>
</blockquote>
<ol>
<li>
<p>Configure Etcd version and ports</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">ETCD_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;3.4.9&#34;</span>
<span style="color:#204a87">export</span> <span style="color:#000">CLIENT_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2379&#34;</span>
<span style="color:#204a87">export</span> <span style="color:#000">PEERS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2380&#34;</span>
</code></pre></div><blockquote>
<p><strong>If targeting Kubernetes Master nodes, you must change
<code>CLIENT_PORT</code>, <code>PEERS_PORT</code></strong></p>
</blockquote>
</li>
<li>
<p>Download Etcd from CoreOS official site</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -L https://github.com/coreos/etcd/releases/download/v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz -o /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz
mkdir -p /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64
tar -xzvf /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz -C /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64 --strip-components<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
rm /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz
</code></pre></div></li>
<li>
<p>Install Etcd binaries</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">cd</span> /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64
mv etcd /usr/local/sbin/etcd3
mv etcdctl /usr/local/sbin/etcdctl
chmod <span style="color:#0000cf;font-weight:bold">0755</span> /usr/local/sbin/etcd3 /usr/local/sbin/etcdctl
</code></pre></div></li>
<li>
<p>Set up persistent Etcd data directory</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /var/lib/storageos-etcd
</code></pre></div></li>
<li>
<p>Create the systemd environment file</p>
<p>On all nodes that will run etcd create a systemd environemnt file
<code>/etc/etcd.conf</code> which has the IPs of all the nodes. The <code>NODE_IP</code> will
need to change to correspond to the node IP where the environment file
resides. <code>NODE1_IP</code>, <code>NODE2_IP</code> and <code>NODE3_IP</code> will remain the same across
all three files.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#4e9a06">&lt;&lt;END &gt; /etc/etcd.conf
</span><span style="color:#4e9a06"># NODE_IP is the IP of the node where this file resides.
</span><span style="color:#4e9a06">NODE_IP=10.64.10.228
</span><span style="color:#4e9a06"># Node 1 IP
</span><span style="color:#4e9a06">NODE1_IP=10.64.10.228
</span><span style="color:#4e9a06"># Node 2 IP
</span><span style="color:#4e9a06">NODE2_IP=10.64.14.233
</span><span style="color:#4e9a06"># Node 3 IP  
</span><span style="color:#4e9a06">NODE3_IP=10.64.12.111
</span><span style="color:#4e9a06">CLIENT_PORT=${CLIENT_PORT}
</span><span style="color:#4e9a06">PEERS_PORT=${PEERS_PORT}
</span><span style="color:#4e9a06">END</span>

<span style="color:#8f5902;font-style:italic"># Verify that variables are expanded in the file</span>
$ cat /etc/etcd.conf

</code></pre></div></li>
<li>
<p>Create the systemd unit file for etcd3 service</p>
<p>Create a systemd unit file <code>/etc/systemd/system/etcd3.service</code> with the
following information:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>Unit<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span>etcd3
<span style="color:#000">Documentation</span><span style="color:#ce5c00;font-weight:bold">=</span>https://github.com/coreos/etcd
<span style="color:#000">Conflicts</span><span style="color:#ce5c00;font-weight:bold">=</span>etcd2.service

<span style="color:#ce5c00;font-weight:bold">[</span>Service<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>notify
<span style="color:#000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span>always
<span style="color:#000">RestartSec</span><span style="color:#ce5c00;font-weight:bold">=</span>5s
<span style="color:#000">LimitNOFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">40000</span>
<span style="color:#000">TimeoutStartSec</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#000">EnvironmentFile</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/etcd.conf

<span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>/usr/local/sbin/etcd3 --name etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --heartbeat-interval <span style="color:#0000cf;font-weight:bold">500</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --election-timeout <span style="color:#0000cf;font-weight:bold">5000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --max-snapshots <span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --max-wals <span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --data-dir /var/lib/storageos-etcd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quota-backend-bytes <span style="color:#0000cf;font-weight:bold">8589934592</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --snapshot-count <span style="color:#0000cf;font-weight:bold">100000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-retention <span style="color:#0000cf;font-weight:bold">20000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-mode revision <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-state new <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-token etcd-token <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-client-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span>,http://127.0.0.1:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --advertise-client-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-peer-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-advertise-peer-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>


<span style="color:#ce5c00;font-weight:bold">[</span>Install<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span>multi-user.target
</code></pre></div><blockquote>
<p><code>$NODE_IP</code> is the IP address of the machine you are installing etcd on.`</p>
</blockquote>
<blockquote>
<p>Note that setting the advertise-client-urls incorrectly will cause any
client connection to fail. Ondat will fail to communicate to Etcd.</p>
</blockquote>
<blockquote>
<p>If enabling TLS, it is recomended to generate your own CA certificate
and key. You will need to distribute the keys and certificates for the
client auth on all etcd nodes. Moreover, the <code>ExecStart</code> value should
look as below:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>/usr/local/sbin/etcd3 --name etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --heartbeat-interval <span style="color:#0000cf;font-weight:bold">500</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --election-timeout <span style="color:#0000cf;font-weight:bold">5000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --max-snapshots <span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --max-wals <span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --data-dir /var/lib/storageos-etcd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quota-backend-bytes <span style="color:#0000cf;font-weight:bold">8589934592</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --snapshot-count <span style="color:#0000cf;font-weight:bold">100000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-retention <span style="color:#0000cf;font-weight:bold">20000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-mode revision <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --peer-auto-tls <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --client-cert-auth --trusted-ca-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/client-cert.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --cert-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/ca.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --key-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/client-key.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-state new <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-token etcd-token <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-client-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --advertise-client-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-peer-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-advertise-peer-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>
</code></pre></div></li>
<li>
<p>Reload and start the etc3 systemd service</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ systemctl daemon-reload
$ systemctl <span style="color:#204a87">enable</span> etcd3.service
$ systemctl start  etcd3.service
</code></pre></div></li>
<li>
<p>Installation Verification</p>
<blockquote>
<p>The <code>etcdctl</code> binary is installed at <code>/usr/local/bin</code> on the nodes.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh <span style="color:#000">$NODE</span> <span style="color:#8f5902;font-style:italic"># Any node running the new etcd</span>
$ <span style="color:#000">ETCDCTL_API</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span> etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span>http://127.0.0.1:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> member list <span style="color:#8f5902;font-style:italic"># $NODE_IP - the IP of the node</span>
66946cff1224bb5, started, etcd-b94bqkb9rf,  http://172.28.0.1:2380, http://172.28.0.1:2379
17e7256953f9319b, started, etcd-gjr25s4sdr, http://172.28.0.2:2380, http://172.28.0.2:2379
8b698843a4658823, started, etcd-rqdf9thx5p, http://172.28.0.3:2380, http://172.28.0.3:2379
</code></pre></div><blockquote>
<p>Read the <a href="https://docs.ondat.io/v2.4/docs/operations/etcd/">etcd operations</a>
page for our etcd recommendations.</p>
</blockquote>
</li>
</ol>
<h3 id="installation---ansible">Installation - Ansible</h3>
<p>For a repeatable and automated installation, use of a configuration management
tool such as ansible is recommended. Ondat provides an ansible playbook to
help you deploy etcd on standalone virtual machines.</p>
<ol>
<li>
<p>Clone Ondat deployment repository</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/storageos/deploy.git
<span style="color:#204a87">cd</span> k8s/deploy-storageos/etcd-helpers/etcd-ansible-systemd
</code></pre></div></li>
<li>
<p>Edit the inventory file</p>
<blockquote>
<p>The inventory file targets the nodes that will run etcd. The file
<code>hosts</code> is an example of such an inventory file.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat hosts
<span style="color:#ce5c00;font-weight:bold">[</span>nodes<span style="color:#ce5c00;font-weight:bold">]</span>
centos-1 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.10.228&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-10-228.eu-west-2.compute.internal&#34;</span>
centos-2 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.14.233&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-14-233.eu-west-2.compute.internal&#34;</span>
centos-3 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.12.111&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-12-111.eu-west-2.compute.internal&#34;</span>

<span style="color:#8f5902;font-style:italic"># Edit the inventory file</span>
$ vi hosts <span style="color:#8f5902;font-style:italic"># Or your own inventory file</span>
</code></pre></div><blockquote>
<p>The ip or fqdn are used to expose the advertise-client-urls of Etcd.
Failing to provide valid ip/fqdn will cause any client connection to
fail. Ondat will fail to communicate to Etcd.</p>
</blockquote>
</li>
<li>
<p>Edit the etcd configuration</p>
<blockquote>
<p><strong>If targeting Kubernetes Master nodes, you must change
<code>etcd_port_client</code>, <code>etcd_port_peers</code></strong></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat group_vars/all
etcd_version: <span style="color:#4e9a06">&#34;3.4.9&#34;</span>
etcd_port_client: <span style="color:#4e9a06">&#34;2379&#34;</span>
etcd_port_peers: <span style="color:#4e9a06">&#34;2380&#34;</span>
etcd_quota_bytes: <span style="color:#0000cf;font-weight:bold">8589934592</span>  <span style="color:#8f5902;font-style:italic"># 8 GB</span>
etcd_auto_compaction_mode: <span style="color:#4e9a06">&#34;revision&#34;</span>
etcd_auto_compaction_retention: <span style="color:#4e9a06">&#34;1000&#34;</span>
members: <span style="color:#4e9a06">&#34;{{ groups[&#39;nodes&#39;] }}&#34;</span>
installation_dir: <span style="color:#4e9a06">&#34;/var/lib/storageos-etcd&#34;</span>
advertise_format: <span style="color:#4e9a06">&#39;fqdn&#39;</span> <span style="color:#8f5902;font-style:italic"># fqdn || ip</span>
backup_file: <span style="color:#4e9a06">&#34;/tmp/backup.db&#34;</span>

tls:
  enabled: <span style="color:#204a87">false</span>
  ca_common_name: <span style="color:#4e9a06">&#34;eu-west-2.compute.internal&#34;</span>
  etcd_common_name: <span style="color:#4e9a06">&#34;*.eu-west-2.compute.internal&#34;</span>
  cert_dir: <span style="color:#4e9a06">&#34;/etc/etcdtls&#34;</span>
  ca_cert_file: <span style="color:#4e9a06">&#34;etcd-ca.pem&#34;</span>
  etcd_server_cert_file: <span style="color:#4e9a06">&#34;server.pem&#34;</span>
  etcd_server_key_file: <span style="color:#4e9a06">&#34;server-key.pem&#34;</span>
  etcd_client_cert_file: <span style="color:#4e9a06">&#34;etcd-client.crt&#34;</span>
  etcd_client_key_file: <span style="color:#4e9a06">&#34;etcd-client.key&#34;</span>

$ vi group_vars/all
</code></pre></div><blockquote>
<p>Choose between using IP addressing or FQDN in the <code>advertise_format</code>
parameter. It allows you to decide how Etcd advertises its address to
clients. This is particularly relevant when using TLS.</p>
</blockquote>
<blockquote>
<p>If enabling TLS, it is recomended to generate your own CA certificate
and key. You can do it by generating the CA from the machine running
Ansible by: <code>ansible-playbook create_ca.yaml</code>.</p>
</blockquote>
</li>
<li>
<p>Install</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-playbook -i hosts install.yaml
</code></pre></div></li>
<li>
<p>Installation Verification</p>
<blockquote>
<p>The playbook installs the <code>etcdctl</code> binary on the nodes, at
<code>/usr/local/bin</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh <span style="color:#000">$NODE</span> <span style="color:#8f5902;font-style:italic"># Any node running the new etcd</span>
$ <span style="color:#000">ETCDCTL_API</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span> etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span>127.0.0.1:2379 member list
66946cff1224bb5, started, etcd-b94bqkb9rf,  http://172.28.0.1:2380, http://172.28.0.1:2379
17e7256953f9319b, started, etcd-gjr25s4sdr, http://172.28.0.2:2380, http://172.28.0.2:2379
8b698843a4658823, started, etcd-rqdf9thx5p, http://172.28.0.3:2380, http://172.28.0.3:2379
</code></pre></div></li>
</ol>
<h2 id="benefits-of-running-external-to-kubernetes">Benefits of Running External to Kubernetes</h2>
<p>Etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. In the case that quorum is lost, an etcd node stops and marks its
contents as read-only. Another peer might have a newer version that has not
been committed to the database. Quorum is fundamental for etcd operations.</p>
<p>In a Kubernetes environment, applications are scheduled across and in some
scenarios such as &ldquo;DiskPressure&rdquo; they may need to be evicted from a node, and
be scheduled onto a different node. With an application such as etcd, the
scenario described can result in quorum being lost, making the cluster unable
to recover automatically. Usually a 3 node etcd cluster can survive losing one
node and recover. However, losing a second node at the same time or even
having a network partition between them will result in quorum lost.</p>
<h2 id="bind-etcd-ips-to-kubernetes-service">Bind Etcd IPs to Kubernetes Service</h2>
<p>Kubernetes external services use a DNS name to reference external endpoints,
making them easy to reference from inside the cluster.  You can use the
example from the <a href="https://github.com/storageos/deploy/tree/master/k8s/deploy-storageos/etcd-helpers/etcd-external-svc">helper github
repository</a>
to deploy the external Service. Using an external service can make monitoring
of etcd from Prometheus easier.</p>

</div>





</div>

<h2 id="using-etcd-with-ondat">Using Etcd with Ondat</h2>
<p>During installation of Ondat the <code>kvBackend.address</code> parameter of the
Ondat operator is used to specify the address of the etcd cluster. See the
<a href="https://docs.ondat.io/v2.4/docs/reference/cluster-operator/examples/#installing-with-an-external-etcd">Ondat cluster operator configuration</a> examples for more information.</p>

	
	
	<div class="text-muted mt-5 pt-3 border-top"></div>
</div>


          </main>
        </div>
      </div>

    </div>
    <div id="ondat-lp-footer">
  <div class="ondat-lp-footer-wrapper">
    <div class="ondat-lp-footer-wrapper-left">
      <a class="navbar-brand" href="https://ondat.io">
        <svg width="135" height="24" viewBox="0 0 135 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M48.8466 13.2064V10.5821c0-4.27515 2.2857-6.56086 6.9841-6.56086 4.8254.0 6.9418 2.20106 6.9418 6.56086v2.6243c0 4.2328-2.2857 6.5609-6.9418 6.5609C50.963 19.8096 48.8466 17.6085 48.8466 13.2064zm10.836-2.6243C59.6826 8.0424 58.836 6.94188 55.8731 6.94188c-2.963.0-3.8519 1.10052-3.8519 3.64022v2.6243c0 2.5397.846600000000002 3.6402 3.8519 3.6402 2.9629.0 3.8095-1.0582 3.8095-3.6402V10.5821z" fill="#1239b8"/><path d="M68.91 18.074C68.91 19.1745 68.6561 19.4285 67.5555 19.4285H67.1746C66.074 19.4285 65.8201 19.1745 65.8201 18.074V9.90469C65.8201 5.96818 68.0635 3.97876 72.4656 3.97876 77.0793 3.97876 79.0687 5.96818 79.0687 9.90469V18.074C79.0687 19.1745 78.8148 19.4285 77.7143 19.4285h-.381C76.2328 19.4285 75.9788 19.1745 75.9788 18.074V9.90469C75.9788 7.83061 75.2169 6.94172 72.5079 6.94172 69.7989 6.94172 68.9947 7.87294 68.9947 9.90469V18.074H68.91z" fill="#1239b8"/><path d="M95.1534 13.5026C95.1534 17.6931 92.9947 19.7248 88.6772 19.7248 84.1481 19.7248 82.2433 17.5237 82.2433 13.5026v-2.963c0-4.06347 1.7778-6.26453 6.2646-6.26453 2.5397.0 4.1905.80423 4.9524 2.45502V1.31211C93.4603.719513 93.6296.592529 94.1799.592529H94.3492C94.9418.592529 95.0687.761841 95.0687 1.31211V13.5026H95.1534zm-11.2593.0C83.8941 16.7618 85.037 18.2433 88.7195 18.2433c3.64030000000001.0 4.8254-1.4815 4.8254-4.7407V10.4973C93.5449 7.23803 92.4021 5.75655 88.7195 5.75655 85.0793 5.75655 83.8941 7.23803 83.8941 10.4973v3.0053z" fill="#017efa"/><path d="M111.323 19.0053C111.323 19.5979 111.153 19.7249 110.603 19.7249H110.434C109.841 19.7249 109.714 19.5556 109.714 19.0053V17.3122C108.952 18.9207 107.259 19.7672 104.762 19.7672c-4.487.0-6.2646-2.2434-6.2646-6.2645V10.4974C98.4974 6.43388 100.317 4.27515 104.931 4.27515c4.27500000000001.0 6.476 2.07407 6.476 6.22225v8.5079H111.323zm-11.302-5.5026c0 3.2592 1.143 4.7407 4.82599999999999 4.7407 3.682.0 4.825-1.4815 4.825-4.7407V10.4974c0-3.25929-1.143-4.74077-4.825-4.74077C101.164 5.75663 100.021 7.23811 100.021 10.4974v3.0053z" fill="#017efa"/><path d="M113.862 5.3756C113.862 4.99465 113.947 4.86766 114.413 4.78301l1.947-.21164L116.656 1.14279C116.741.677185 116.868.592529 117.249.592529H117.418C117.884.592529 117.968.761841 117.968 1.14279V4.57137h5.461C124.021 4.57137 124.148 4.74068 124.148 5.29094v.12699C124.148 5.92586 124.021 6.1375 123.429 6.1375h-5.461v8.4233c0 2.709 1.101 3.7248 3.133 3.7248C122.159 18.2856 123.09 18.1587 123.979 17.9047 124.444 17.7354 124.698 17.947 124.698 18.4973V18.6243C124.698 19.1322 124.529 19.3438 123.979 19.4708 123.132 19.7248 122.201 19.8518 121.143 19.8518c-3.217.0-4.783-1.7778-4.783-5.2487V6.05285h-1.947C114.032 6.05285 113.862 5.88353 113.862 5.50258V5.3756z" fill="#017efa"/><path d="M130.794 4.78311C130.794 4.95242 130.751 4.99475 130.582 4.99475H129.905v2.1164C129.905 7.32279 129.862 7.36512 129.651 7.36512H129.566C129.355 7.36512 129.312 7.32279 129.312 7.11115V4.99475H128.635C128.466 4.99475 128.423 4.95242 128.423 4.78311V4.69846C128.423 4.52914 128.466 4.48682 128.635 4.48682h1.947C130.751 4.48682 130.794 4.52914 130.794 4.69846V4.78311zM134.392 7.11115C134.392 7.32279 134.349 7.36512 134.138 7.36512H134.053C133.841 7.36512 133.799 7.32279 133.799 7.11115V4.99475L133.206 7.06883C133.164 7.28047 133.079 7.36512 132.825 7.36512 132.656 7.36512 132.529 7.28047 132.444 7.06883L131.852 4.99475v2.1164C131.852 7.32279 131.81 7.36512 131.598 7.36512H131.513C131.302 7.36512 131.259 7.32279 131.259 7.11115V4.86777c0-.25397.12700000000001-.38095.381-.38095H131.894C132.148 4.48682 132.318 4.65613 132.402 4.95242L132.825 6.60322 133.291 4.86777C133.333 4.57147 133.503 4.48682 133.841 4.48682H133.968C134.222 4.48682 134.349 4.6138 134.349 4.86777V7.11115H134.392z" fill="#017efa"/><path d="M0 7.83057V16.1692l10.1587-4.1905L0 7.83057z" fill="#017efa"/><path d="M10.1587 11.9788l8.9736-3.64018V0L0 7.83069 10.1587 11.9788z" fill="#1239b8"/><path d="M0 16.1692l19.1323 7.8307V15.6613l-8.9736-3.6825L0 16.1692z" fill="#0bbbef"/><path d="M30.0106 11.9787l10.1587 4.1905V7.83057L30.0106 11.9787z" fill="#017efa"/><path d="M40.1692 7.83069 20.9946.0V8.33862l9.0159 3.64018L40.1692 7.83069z" fill="#0bbbef"/><path d="M20.9946 15.6613v8.3386l19.1746-7.8307-10.1587-4.1904-9.0159 3.6825z" fill="#1239b8"/></g><defs><clipPath id="clip0"><rect width="134.392" height="24" fill="#fff"/></clipPath></defs></svg>
        <span class="text-uppercase font-weight-bold"></span>
      </a>
      <ul>
        <li class="ondat-lp-footer-header">Platform</li>
        <li><a href="https://ondat.io/platform/platform-overview">Platform Overview</a></li>
        <li><a href="https://ondat.io/platform/how-it-works">How it works</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Teams</li>
        <li><a href="https://ondat.io/teams/development">Development</a></li>
        <li><a href="https://ondat.io/teams/devops-sre">DevOps SRE</a></li>
        <li><a href="https://ondat.io/digital-transformation">Digital Transformation</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Solutions</li>
        <li><a href="https://ondat.io/solutions/stateful-applications">Stateful Apps</a></li>
        <li><a href="https://ondat.io/solutions/kubernetes-distributions">Kubernetes Distros</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Blog</li>
        <li class="ondat-lp-footer-header"><a href="https://www.ondat.io/blog">Ondat Blog</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Contact Us</li>
      </ul>
    </div>
    <div class="ondat-lp-footer-wrapper-right"></div>
  </div>
</div>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Open+Sans:wght@500&display=swap");
  #ondat-lp-footer {
    background-color: #f8f9ff;
    padding: 120px 0;
  }
  .ondat-lp-footer-wrapper {
    max-width: 1240px;
    margin: auto;
    display: flex;
  }
  .ondat-lp-footer-wrapper-left {
    display: flex;
  }

  .ondat-lp-footer-wrapper-left ul,
  .ondat-lp-footer-wrapper-left ul li {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .ondat-lp-footer-wrapper-left ul {
    margin-left: 60px;
  }
  .ondat-lp-footer-wrapper-left ul li a {
    text-decoration: none;
    color: #5e6a8e;
    font-weight: 400;
    font-size: 12px;
    margin-top: 18px;
    display: block;
  }
  .ondat-lp-footer-wrapper-left ul li.ondat-lp-footer-header {
    font-weight: 700;
    font-size: 14px;
    color: #081d60;
  }
  .ondat-lp-footer-wrapper-right {
  }
</style>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>









<script src="/v2.4/js/main.min.648fa099c4460d7e569f8c1e4ae2eaf6b7ed3e7235aabe0f50e72f2356c5e7d9.js" integrity="sha256-ZI&#43;gmcRGDX5Wn4weSuLq9rftPnI1qr4PUOcvI1bF59k=" crossorigin="anonymous"></script>


<script type="text/javascript"
	  id="hs-script-loader"
	  async
	  defer
	  src="//js.hs-scripts.com/3402546.js"></script>



  </body>
</html>
